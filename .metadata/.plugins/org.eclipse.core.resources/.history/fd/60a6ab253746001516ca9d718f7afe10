// Function is collecting information for geolocation and local weather

var api = require("api");

var osname = Ti.Platform.osname;
var online = Ti.Network.online;
var location = Ti.Geolocation.locationServicesEnabled;

if(osname === "android"){
	Titanium.Geolocation.accuracy = Titanium.Geolocation.ACCURACY_HIGH;
};

var getGeo = function(){
	if(online === true && location === true){
		if(osname === "android"){
			Ti.Geolocation.purpose = "Current location is needed to get your local weather."; 
		};
		Ti.Geolocation.getCurrentPosition(function(e){
			var latitude = e.coords.latitude;
			var longitude = e.coords.longitude;
			var url = "http://api.wunderground.com/api/d2e13383813c88c5/conditions/alert/almanac/q/" + longitude + "," + latitude + "/json";
			var getData = Ti.Network.createHTTPClient();
			getData.onload = function(e){
				Ti.App.Properties.getString("weatherJSON", this.responseText);
			};	
			getData.open("GET", url);
			getData.send();
			loadui.rnWthr();
		});
		
	}else{
		loadui.rnWthr();
	};
};
getGeo();
win.addEventListener("swipe", function(e){
	if(e.direction == "down"){
		getGeo();
	};
});